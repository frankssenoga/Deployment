<!DOCTYPE html>
<html>
<head>
  <title>Virtual Machine Instance Attack Predictor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 2rem;
      display: flex;
      justify-content: center;
    }

    form {
      margin-left: 80px;
      margin-right: 80px;
    }

    .form-container {
      width: 800px;
      background-color: #060606;
      color: #f0f0f0;
      padding: 30px;
      border: 6px solid #444;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }

    h2 {
      text-align: center;
      font-size: 37px;
      color: #219077;
    }

    label {
      display: inline-block;
      width: 320px;
      font-size: 14px;
      white-space: nowrap;
      color: #f0f0f0;
    }

    input {
      width: 220px;
      padding: 2px 4px;
      font-size: 14px;
      background: #2a2a2a;
      color: #fff;
      border: 1px solid #666;
      margin-left: 24px;
    }

    .btn:hover  { background:#3b3b3b; }
    .btn:active { background:#444; }

    .btn-row {
      display: flex;
      justify-content: center;
      gap: 2cm;
      margin-top: 50px;
      width: 100%;
    }

    .shap-section {
      background-color: #121212;
      padding: 20px;
      margin-top: 30px;
      border: 2px solid #555;
      border-radius: 10px;
    }

    .shap-section h4 {
      color: #00ffc8;
      margin-bottom: 20px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      text-transform: uppercase;
    }

    .shap-section ul {
      list-style: none;
      padding: 0;
    }

    .shap-section li {
      padding: 6px 0;
      border-bottom: 1px solid #333;
      font-size: 14px;
    }
  </style>
</head>
<body>

<div class="form-container">
  <div style="text-align: center;">
    <img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="Logo" class="logo">
  </div>

  <h2>VM-Instance Security Prediction Tool</h2>

  <form id="predict-form" method="POST" action="/predict">

    <label for="rxbytes_rate">Number of bytes received on the Network (bytes/sec):</label>
    <input type="text" name="rxbytes_rate" value="{{ values.rxbytes_rate }}"><br><br>

    <label for="txbytes_rate">Number of bytes transmitted on the Network (bytes/sec):</label>
    <input type="text" name="txbytes_rate" value="{{ values.txbytes_rate }}"><br><br>

    <label for="timecpu">CPU total time (seconds):</label>
    <input type="text" name="timecpu" value="{{ values.timecpu }}"><br><br>

    <label for="timesys">CPU system time (seconds):</label>
    <input type="text" name="timesys" value="{{ values.timesys }}"><br><br>

    <label for="timeusr">CPU user time (seconds):</label>
    <input type="text" name="timeusr" value="{{ values.timeusr }}"><br><br>

    <label for="state">VM state (numeric code):</label>
    <input type="text" name="state" value="{{ values.state }}"><br><br>

    <label for="cputime">Total CPU time usage (seconds):</label>
    <input type="text" name="cputime" value="{{ values.cputime }}"><br><br>

    <label for="memminor_fault">Minor memory faults (count):</label>
    <input type="text" name="memminor_fault" value="{{ values.memminor_fault }}"><br><br>

    <label for="memunused">Unused memory (MB):</label>
    <input type="text" name="memunused" value="{{ values.memunused }}"><br><br>

    <label for="memlast_update">Last memory update (timestamp or delta):</label>
    <input type="text" name="memlast_update" value="{{ values.memlast_update }}"><br><br>

    <label for="memrss">Resident Set Size (memory usage in MB):</label>
    <input type="text" name="memrss" value="{{ values.memrss }}"><br><br>

    <label for="vdard_req_rate">Virtual Disk Read Requests Rate (req/sec):</label>
    <input type="text" name="vdard_req_rate" value="{{ values.vdard_req_rate }}"><br><br>

    <label for="vdard_bytes_rate">Virtual Disk Read Bytes Rate (bytes/sec):</label>
    <input type="text" name="vdard_bytes_rate" value="{{ values.vdard_bytes_rate }}"><br><br>

    <label for="vdawr_reqs_rate">Virtual Disk Write Requests Rate (req/sec):</label>
    <input type="text" name="vdawr_reqs_rate" value="{{ values.vdawr_reqs_rate }}"><br><br>

    <label for="vdawr_bytes_rate">Virtual Disk Write Bytes Rate (bytes/sec):</label>
    <input type="text" name="vdawr_bytes_rate" value="{{ values.vdawr_bytes_rate }}"><br><br>

    <label for="hdard_req_rate">Hardware Disk Read Requests Rate (req/sec):</label>
    <input type="text" name="hdard_req_rate" value="{{ values.hdard_req_rate }}"><br><br>

    <label for="hdard_bytes_rate">Hardware Disk Read Bytes Rate (bytes/sec):</label>
    <input type="text" name="hdard_bytes_rate" value="{{ values.hdard_bytes_rate }}"><br><br>

    <div class="btn-row">
      <button class="btn" type="submit">Predict</button>
      <button class="btn" type="button" onclick="clearForm()">Clear</button>
    </div>
  </form>

  {% if prediction %}
    <h3 style="text-align:center; color: rebeccapurple; margin-top: 30px;">
      Prediction: {{ prediction }}
    </h3>
  {% endif %}

  {% if top_features %}
  <div class="shap-section">
    <h4>Top Contributing Features (SHAP)</h4>
    <ul>
      {% for f in top_features %}
        <li>
          <strong>{{ f.feature }}</strong>: {{ f.value }}
          &nbsp;&nbsp;â†’&nbsp;&nbsp; Impact: <span style="color:lightgreen">{{ f.impact }}</span>
        </li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}
</div>

<script>
  function addCommas(e) {
    const el = e.target;
    if (!el.value) return;
    const clean = el.value.replace(/,/g, '');
    if (isNaN(clean)) return;
    const parts = clean.split('.');
    parts[0] = parseInt(parts[0], 10).toLocaleString('en-US');
    el.value = parts.join('.');
  }

  document.querySelectorAll('#predict-form input')
          .forEach(inp => inp.addEventListener('input', addCommas));

  function clearForm () {
    document.querySelectorAll('#predict-form input').forEach(i => i.value = '');
  }
</script>

</body>
</html>
